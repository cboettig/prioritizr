<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Connectivity matrix — connectivity_matrix • prioritizr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Connectivity matrix — connectivity_matrix" />
<meta property="og:description" content="Create a matrix showing the connectivity between planning units. Connectivity
is calculated as the average conductance of two planning units multiplied
by the amount of shared boundary between the two planning units. Thus
planning units that each have higher a conductance and share a greater
boundary are associated with greater connectivity." />
<meta property="og:image" content="https://prioritizr.net/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">5.0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/saltspring.html">Salt Spring Island Tutorial</a>
    </li>
    <li>
      <a href="../articles/tasmania.html">Tasmania Tutorial</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/prioritizr/prioritizr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Connectivity matrix</h1>
    <small class="dont-index">Source: <a href='https://github.com/prioritizr/prioritizr/blob/master/R/connectivity_matrix.R'><code>R/connectivity_matrix.R</code></a></small>
    <div class="hidden name"><code>connectivity_matrix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create a matrix showing the connectivity between planning units. Connectivity
is calculated as the average conductance of two planning units multiplied
by the amount of shared boundary between the two planning units. Thus
planning units that each have higher a conductance and share a greater
boundary are associated with greater connectivity.</p>
    </div>

    <pre class="usage"><span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for Spatial,Raster</span>
<span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for Spatial,character</span>
<span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for sf,character</span>
<span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for sf,Raster</span>
<span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for Raster,Raster</span>
<span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>Raster</code>,
<code>SpatialPolygonsDataFrame</code>,
<code>SpatialLinesDataFrame</code>,
or <code><a href='https://r-spatial.github.io/sf/reference/sf.html'>sf::sf()</a></code> object
representing planning units.
If <code>x</code> is a <code>Raster</code> object then it must
contain a single layer.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p><code>Raster</code> object showing the conductance
of different areas across the study area, or a <code>character</code> object
denoting a column name in the attribute table of <code>x</code> that contains
the conductance values. Note that argument to <code>y</code> can only be a
<code>character</code> object if the argument to <code>x</code> is a
<code>Spatial</code> or <code><a href='https://r-spatial.github.io/sf/reference/sf.html'>sf::sf()</a></code> object.
Also, note that if the argument to <code>x</code> is a
<code>Raster</code> object then
argument to <code>y</code> must have the same spatial properties as it
(i.e. coordinate system, extent, resolution).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments passed to <code><a href='fast_extract.html'>fast_extract()</a></code> for
extracting and calculating the conductance values for each planning unit.
These arguments are only used if argument to <code>x</code> is a
<code>link[sp]{Spatial-class}</code> or <code><a href='https://r-spatial.github.io/sf/reference/sf.html'>sf::sf()</a></code> object and argument
to <code>y</code> is a <code>Raster</code> object.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code><a href='https://rdrr.io/pkg/Matrix/man/dsCMatrix-class.html'>dsCMatrix</a></code> symmetric sparse matrix object.
Each row and column represents a planning unit.
Cells values indicate the connectivity between different pairs of planning
units.
To reduce computational burden, cells among the matrix diagonal are
set to zero. Furthermore, if the argument to <code>x</code> is a
<code>Raster</code> object, then cells with <code>NA</code>
values are set to zero too.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Shared boundary calculations are performed using
<code><a href='boundary_matrix.html'>boundary_matrix()</a></code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># load data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>sim_pu_raster</span>, <span class='va'>sim_pu_sf</span>, <span class='va'>sim_features</span><span class='op'>)</span>

<span class='co'># create connectivity matrix using raster planning unit data using</span>
<span class='co'># the raster cost values to represent conductance</span>
<span class='co'>## extract 9 planning units</span>
<span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'>crop</span><span class='op'>(</span><span class='va'>sim_pu_raster</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.3</span>, <span class='fl'>0</span>, <span class='fl'>0.3</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## extract conductance data for the 9 planning units</span>
<span class='va'>cd</span> <span class='op'>&lt;-</span> <span class='fu'>crop</span><span class='op'>(</span><span class='va'>sim_features</span>, <span class='va'>r</span><span class='op'>)</span>

<span class='co'>## make connectivity matrix using the habitat suitability data for the</span>
<span class='co'>## second feature to represent the planning unit conductance data</span>
<span class='va'>cm_raster</span> <span class='op'>&lt;-</span> <span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>r</span>, <span class='va'>cd</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>

<span class='co'>## plot data and matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>r</span>, main <span class='op'>=</span> <span class='st'>"planning units (raster)"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>cd</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>, main <span class='op'>=</span> <span class='st'>"conductivity"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>clamp</span><span class='op'>(</span><span class='fu'>raster</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>cm_raster</span><span class='op'>)</span><span class='op'>)</span>, lower <span class='op'>=</span> <span class='fl'>1e-5</span>, useValues <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
     main <span class='op'>=</span> <span class='st'>"connectivity"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='connectivity_matrix-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># create connectivity matrix using polygon planning unit data using</span>
<span class='co'># the habitat suitability data for the second feature to represent</span>
<span class='co'># planning unit conductances</span>
<span class='co'>## subset data to 9 polygons</span>
<span class='va'>ply</span> <span class='op'>&lt;-</span> <span class='va'>sim_pu_sf</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, <span class='fl'>10</span><span class='op'>:</span><span class='fl'>12</span>, <span class='fl'>20</span><span class='op'>:</span><span class='fl'>22</span><span class='op'>)</span>, <span class='op'>]</span>

<span class='co'>## make connectivity matrix</span>
<span class='va'>cm_ply</span> <span class='op'>&lt;-</span> <span class='fu'>connectivity_matrix</span><span class='op'>(</span><span class='va'>ply</span>, <span class='va'>sim_features</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>

<span class='co'>## plot data and matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>st_geometry</span><span class='op'>(</span><span class='va'>ply</span><span class='op'>)</span>, main <span class='op'>=</span> <span class='st'>"planning units (sf)"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>clamp</span><span class='op'>(</span><span class='fu'>raster</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>cm_ply</span><span class='op'>)</span><span class='op'>)</span>, lower <span class='op'>=</span> <span class='fl'>1e-5</span>, useValues <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
     main <span class='op'>=</span> <span class='st'>"connectivity"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='connectivity_matrix-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>

<span class='co'># create connectivity matrix using habitat suitability data for each feature,</span>
<span class='co'># this could be useful if prioritisations should spatially clump</span>
<span class='co'># together adjacent planning units that have suitable habitat</span>
<span class='co'># for the same species (e.g. to maintain functional connectivity)</span>

<span class='co'>## let's use the raster data for this example, and we can generate the</span>
<span class='co'>## connectivity matrix that we would use in the prioritization by</span>
<span class='co'>## (1) generating a connectivity matrix for each feature separately, and</span>
<span class='co'>## and then (2) then summing the values together</span>
<span class='va'>cm_sum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>as.list</a></span><span class='op'>(</span><span class='va'>cd</span><span class='op'>)</span>, <span class='va'>connectivity_matrix</span>, x <span class='op'>=</span> <span class='va'>r</span><span class='op'>)</span> <span class='co'># make matrices</span>
<span class='va'>cm_sum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span><span class='op'>(</span><span class='st'>"+"</span>, <span class='va'>cm_sum</span><span class='op'>)</span> <span class='co'># sum matrices together</span>

<span class='co'>## plot data and matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>r</span>, main <span class='op'>=</span> <span class='st'>"planning units (raster)"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>clamp</span><span class='op'>(</span><span class='fu'>raster</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>cm_sum</span><span class='op'>)</span><span class='op'>)</span>, lower <span class='op'>=</span> <span class='fl'>1e-5</span>, useValues <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
     main <span class='op'>=</span> <span class='st'>"connectivity"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='connectivity_matrix-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>

<span class='co'>## we could take this example one step further, and use weights to indicate</span>
<span class='co'>## relative importance of maintaining functional connectivity</span>
<span class='co'>## for each feature (i.e. use the weighted sum instead of the sum)</span>

<span class='co'>## let's pretend that the first feature is 20 times more important</span>
<span class='co'>## than all the other species</span>
<span class='va'>weights</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>20</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>

<span class='co'>## calculate connectivity matrix using weighted sum</span>
<span class='va'>cm_wsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>as.list</a></span><span class='op'>(</span><span class='va'>cd</span><span class='op'>)</span>, <span class='va'>connectivity_matrix</span>, x <span class='op'>=</span> <span class='va'>r</span><span class='op'>)</span> <span class='co'># make matrices</span>
<span class='va'>cm_wsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Map</a></span><span class='op'>(</span><span class='st'>"*"</span>, <span class='va'>cm_wsum</span>, <span class='va'>weights</span><span class='op'>)</span> <span class='co'># multiply by weights</span>
<span class='va'>cm_wsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span><span class='op'>(</span><span class='st'>"+"</span>, <span class='va'>cm_wsum</span><span class='op'>)</span> <span class='co'># sum matrices together</span>

<span class='co'>## plot data and matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>r</span>, main <span class='op'>=</span> <span class='st'>"planning units (raster)"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>clamp</span><span class='op'>(</span><span class='fu'>raster</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>cm_wsum</span><span class='op'>)</span><span class='op'>)</span>, lower <span class='op'>=</span> <span class='fl'>1e-5</span>, useValues <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
     main <span class='op'>=</span> <span class='st'>"connectivity"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='connectivity_matrix-4.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>

<span class='co'>## since the statistical distribution of the connectivity values</span>
<span class='co'>## for each feature (e.g. the mean and standard deviation of the</span>
<span class='co'>## connectivity values) are different, it might make sense -- depending</span>
<span class='co'>## on the goal of the conservation planning exercise and the underlying</span>
<span class='co'>## data -- to first normalize the conductance values before applying the</span>
<span class='co'>## weights and summing the data for feature together</span>

<span class='co'>## one approach would be to linearly rescale the values between 0.01 and 1</span>
<span class='co'>## note that we wouldn't want to rescale them between 0 and 1 since</span>
<span class='co'>## a value of zero means that there is no connectivity at all (and</span>
<span class='co'>## and not a relatively small amount of connectivity)</span>
<span class='co'># \dontrun{</span>
<span class='co'>### define helper function</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://scales.r-lib.org'>scales</a></span><span class='op'>)</span> <span class='co'># load scales library for rescale</span>
<span class='va'>rescale_matrix</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://scales.r-lib.org//reference/rescale.html'>rescale</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.01</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>; <span class='va'>x</span><span class='op'>}</span>

<span class='co'>### calculate functional connectivity matrix using the weighted sum of</span>
<span class='co'>### connectivity values that have been normalized by linearly re-scaling</span>
<span class='co'>### values</span>
<span class='va'>cm_lwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>as.list</a></span><span class='op'>(</span><span class='va'>cd</span><span class='op'>)</span>, <span class='va'>connectivity_matrix</span>, x <span class='op'>=</span> <span class='va'>r</span><span class='op'>)</span> <span class='co'># make matrices</span>
<span class='va'>cm_lwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>cm_lwsum</span>, <span class='va'>rescale_matrix</span><span class='op'>)</span> <span class='co'># rescale matrices to [0.01, 1]</span>
<span class='va'>cm_lwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Map</a></span><span class='op'>(</span><span class='st'>"*"</span>, <span class='va'>cm_lwsum</span>, <span class='va'>weights</span><span class='op'>)</span> <span class='co'># multiply by weights</span>
<span class='va'>cm_lwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span><span class='op'>(</span><span class='st'>"+"</span>, <span class='va'>cm_lwsum</span><span class='op'>)</span> <span class='co'># sum matrices together</span>
<span class='co'># }</span>

<span class='co'>## plot data and matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>r</span>, main <span class='op'>=</span> <span class='st'>"planning units (raster)"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>clamp</span><span class='op'>(</span><span class='fu'>raster</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>cm_lwsum</span><span class='op'>)</span><span class='op'>)</span>, lower <span class='op'>=</span> <span class='fl'>1e-5</span>, useValues <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
     main <span class='op'>=</span> <span class='st'>"connectivity"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='connectivity_matrix-5.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>

<span class='co'>## another approach for normalizing the data could be using z-scores</span>
<span class='co'>## note that after normalizing the data we would need to add a constant</span>
<span class='co'>## value so that none of the connectivity values are negative</span>

<span class='co'>### define helper functions</span>
<span class='va'>zscore</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span><span class='op'>)</span>; <span class='va'>x</span><span class='op'>}</span>
<span class='va'>min_non_zero_value</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span><span class='op'>)</span>
<span class='va'>add_non_zero_value</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='op'>{</span><span class='va'>x</span><span class='op'>@</span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>x</span><span class='op'>@</span><span class='va'>x</span> <span class='op'>+</span> <span class='va'>y</span>; <span class='va'>x</span><span class='op'>}</span>

<span class='co'>### calculate functional connectivity matrix using the weighted sum of</span>
<span class='co'>### connectivity values that have been normalized using z-scores,</span>
<span class='co'>### and transformed to account for negative values</span>
<span class='va'>cm_zwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>as.list</a></span><span class='op'>(</span><span class='va'>cd</span><span class='op'>)</span>, <span class='va'>connectivity_matrix</span>, x <span class='op'>=</span> <span class='va'>r</span><span class='op'>)</span> <span class='co'># make matrices</span>
<span class='va'>cm_zwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>cm_zwsum</span>, <span class='va'>zscore</span><span class='op'>)</span> <span class='co'># normalize using z-scores</span>
<span class='va'>min_value</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='va'>cm_zwsum</span>, <span class='va'>min_non_zero_value</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># find min value</span>
<span class='va'>min_value</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>min_value</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.01</span> <span class='co'># prepare constant for adding to matrices</span>
<span class='va'>cm_zwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>cm_zwsum</span>, <span class='va'>add_non_zero_value</span>, <span class='va'>min_value</span><span class='op'>)</span> <span class='co'># add constant</span>
<span class='va'>cm_zwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Map</a></span><span class='op'>(</span><span class='st'>"*"</span>, <span class='va'>cm_zwsum</span>, <span class='va'>weights</span><span class='op'>)</span> <span class='co'># multiply by weights</span>
<span class='va'>cm_zwsum</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Reduce</a></span><span class='op'>(</span><span class='st'>"+"</span>, <span class='va'>cm_zwsum</span><span class='op'>)</span> <span class='co'># sum matrices together</span>

<span class='co'>## plot data and matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>r</span>, main <span class='op'>=</span> <span class='st'>"planning units (raster)"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'>clamp</span><span class='op'>(</span><span class='fu'>raster</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>cm_zwsum</span><span class='op'>)</span><span class='op'>)</span>, lower <span class='op'>=</span> <span class='fl'>1e-5</span>, useValues <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
     main <span class='op'>=</span> <span class='st'>"connectivity"</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='connectivity_matrix-6.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://jeffrey-hanson.com'>Jeffrey O Hanson</a>, <a href='http://www.richard-schuster.com'>Richard Schuster</a>, Nina Morrell, <a href='http://strimas.com'>Matthew Strimas-Mackey</a>, Matthew E Watts, <a href='https://arcese.forestry.ubc.ca'>Peter Arcese</a>, <a href='https://josephrbennett.wordpress.com'>Joseph Bennett</a>, <a href='http://www.possinghamlab.org'>Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


