<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add connectivity penalties — add_connectivity_penalties • prioritizr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>



<meta property="og:title" content="Add connectivity penalties — add_connectivity_penalties" />
<meta property="og:description" content="Add penalties to a conservation planning problem() to favor
solutions that select planning units with high connectivity between them." />
<meta property="og:image" content="https://prioritizr.net/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70466840-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70466840-4');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">5.0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/prioritizr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/gurobi_installation.html">Gurobi Installation Guide</a>
    </li>
    <li>
      <a href="../articles/publication_record.html">Publication Record</a>
    </li>
    <li>
      <a href="../articles/saltspring.html">Salt Spring Island Tutorial</a>
    </li>
    <li>
      <a href="../articles/tasmania.html">Tasmania Tutorial</a>
    </li>
    <li>
      <a href="../articles/zones.html">Management Zones</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/prioritizr/prioritizr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add connectivity penalties</h1>
    <small class="dont-index">Source: <a href='https://github.com/prioritizr/prioritizr/blob/master/R/add_connectivity_penalties.R'><code>R/add_connectivity_penalties.R</code></a></small>
    <div class="hidden name"><code>add_connectivity_penalties.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Add penalties to a conservation planning <code><a href='problem.html'>problem()</a></code> to favor
solutions that select planning units with high connectivity between them.</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for ConservationProblem,ANY,ANY,matrix</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,Matrix</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,dgCMatrix</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,data.frame</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span>

<span class='co'># S4 method for ConservationProblem,ANY,ANY,array</span>
<span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>penalty</span>, <span class='va'>zones</span>, <span class='va'>data</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code><a href='problem.html'>problem()</a></code> (i.e. <code><a href='ConservationProblem-class.html'>ConservationProblem</a></code>) object.</p></td>
    </tr>
    <tr>
      <th>penalty</th>
      <td><p><code>numeric</code> penalty that is used to scale the importance
of selecting planning units with strong connectivity between them compared
to the main problem objective (e.g. solution cost when the argument to
<code>x</code> has a minimum set objective set using
<code><a href='add_min_set_objective.html'>add_min_set_objective()</a></code>). Higher <code>penalty</code> values
can be used to obtain solutions with a high degree of connectivity,
and smaller <code>penalty</code> values can be used to obtain solutions with a
small degree of connectivity. Note that negative <code>penalty</code> values can
be used to obtain solutions that have very little connectivity.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p><code>matrix</code> or <code>Matrix</code> object describing the
level of connectivity between different zones. Each row and column
corresponds to a different zone in the argument to <code>x</code>, and cell
values indicate the level of connectivity between each combination
of zones. Cell values along the diagonal of the matrix represent
the level of connectivity between planning units allocated to the
same zone. Cell values must lay between 1 and -1, where negative
values favor solutions with weak connectivity. The default argument to
<code>zones</code> is an identity matrix (i.e. a matrix with ones along the
matrix diagonal and zeros elsewhere), so that planning units are
only considered to be connected when they are allocated to the same zone.
This argument is required when the argument to <code>data</code> is a
<code>matrix</code> or <code>Matrix</code> object. If the argument to <code>data</code> is
an <code>array</code> or <code>data.frame</code> with zone data, this argument
must explicitly be set to <code>NULL</code> otherwise an error will be thrown.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p><code>matrix</code>, <code>Matrix</code>, <code>data.frame</code>, or
<code>array</code> object containing connectivity data. The connectivity values
correspond to the strength of connectivity between
different planning units. Thus connections between planning units
that are associated with higher values are more favorable in the solution.
See the Details section for more information.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Object (i.e. <code><a href='ConservationProblem-class.html'>ConservationProblem</a></code>) with the penalties
added to it.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function uses connectivity data to penalize solutions
that have low connectivity. It can accommodate symmetric and asymmetric
relationships between planning units. Although <em>Marxan</em>
<strong>penalizes</strong> connections between planning units with high
connectivity values, it is important to note that this function
<strong>favors</strong> connections between planning units with high connectivity
values. This function was inspired by Beger <em>et al.</em> (2010).</p>
<p>The argument to <code>data</code> can be specified in several different ways:</p>
<dl>

<dt><code>matrix</code>, <code>Matrix</code></dt><dd><p>where rows and columns represent
different planning units and the value of each cell represents the
strength of connectivity between two different planning units. Cells
that occur along the matrix diagonal are treated as weights which
indicate that planning units are more desirable in the solution.
The argument to <code>zones</code> can be used to control
the strength of connectivity between planning units in different zones.
The default argument for <code>zones</code> is to treat planning units
allocated to different zones as having zero connectivity.</p></dd>

<dt><code>data.frame</code></dt><dd><p>containing the fields (columns)
<code>"id1"</code>, <code>"id2"</code>, and <code>"boundary"</code>. Here, each row
denotes the connectivity between two planning units following the
<em>Marxan</em> format. The data can be used to denote symmetric or
asymmetric relationships between planning units. By default,
input data is assumed to be symmetric unless asymmetric data is
also included (e.g. if data is present for planning units 2 and 3, then
the same amount of connectivity is expected for planning units 3 and 2,
unless connectivity data is also provided for planning units 3 and 2).
If the argument to <code>x</code> contains multiple zones, then the columns
<code>"zone1"</code> and <code>"zone2"</code> can optionally be provided to manually
specify the connectivity values between planning units when they are
allocated to specific zones. If the columns <code>"zone1"</code> and
<code>"zone2"</code> are present, then the argument to <code>zones</code> must be
<code>NULL</code>.</p></dd>

<dt><code>array</code></dt><dd><p>containing four-dimensions where cell values
indicate the strength of connectivity between planning units
when they are assigned to specific management zones. The first two
dimensions (i.e. rows and columns) indicate the strength of
connectivity between different planning units and the second two
dimensions indicate the different management zones. Thus
the <code>data[1, 2, 3, 4]</code> indicates the strength of
connectivity between planning unit 1 and planning unit 2 when planning
unit 1 is assigned to zone 3 and planning unit 2 is assigned to zone 4.</p></dd>


</dl>

<p>The connectivity penalties are calculated using the following equations.
Let \(I\) represent the set of planning units
(indexed by \(i\) or \(j\)), \(Z\) represent the set
of management zones (indexed by \(z\) or \(y\)), and \(X_{iz}\)
represent the decision variable for planning unit \(i\) for in zone
\(z\) (e.g. with binary
values one indicating if planning unit is allocated or not). Also, let
\(p\) represent the argument to <code>penalty</code>, \(D\) represent the
argument to <code>data</code>, and \(W\) represent the argument
to <code>zones</code>.</p>
<p>If the argument to <code>data</code> is supplied as a <code>matrix</code> or
<code>Matrix</code> object, then the penalties are calculated as:</p>
<p>$$
 \sum_{i}^{I} \sum_{j}^{I} \sum_{z}^{Z} \sum_{y}^{Z} (-p \times X_{iz}
 \times X_{jy} \times D_{ij} \times W_{zy})$$</p>
<p>Otherwise, if the argument to <code>data</code> is supplied as a
<code>data.frame</code> or <code>array</code> object, then the penalties are
calculated as:</p>
<p>$$
 \sum_{i}^{I} \sum_{j}^{I} \sum_{z}^{Z} \sum_{y}^{Z} (-p \times X_{iz}
 \times X_{jy} \times D_{ijzy})$$</p>
<p>Note that when the problem objective is to maximize some measure of
benefit and not minimize some measure of cost, the term \(-p\) is
replaced with \(p\).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Beger M, Linke S, Watts M, Game E, Treml E, Ball I, and Possingham, HP (2010)
Incorporating asymmetric connectivity into spatial decision making for
conservation, <em>Conservation Letters</em>, 3: 359--368.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='penalties.html'>penalties</a>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># set seed for reproducibility</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>600</span><span class='op'>)</span>

<span class='co'># load Matrix package for visualizing matrices</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='http://Matrix.R-forge.R-project.org/'>Matrix</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required package: Matrix</span></div><div class='input'>
<span class='co'># load data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, <span class='va'>sim_pu_zones_stack</span>, <span class='va'>sim_features</span>, <span class='va'>sim_features_zones</span><span class='op'>)</span>

<span class='co'># define function to rescale values between zero and one so that we</span>
<span class='co'># can compare solutions from different connectivity matrices</span>
<span class='va'>rescale</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>to</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, <span class='va'>from</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>x</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='op'>(</span><span class='va'>x</span> <span class='op'>-</span> <span class='va'>from</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span><span class='op'>(</span><span class='va'>from</span><span class='op'>)</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span><span class='op'>(</span><span class='va'>to</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>to</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
<span class='op'>}</span>

<span class='co'># create basic problem</span>
<span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='problem.html'>problem</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, <span class='va'>sim_features</span>, <span class='st'>"cost"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='add_min_set_objective.html'>add_min_set_objective</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='add_relative_targets.html'>add_relative_targets</a></span><span class='op'>(</span><span class='fl'>0.2</span><span class='op'>)</span>

<span class='co'># create a symmetric connectivity matrix where the connectivity between</span>
<span class='co'># two planning units corresponds to their shared boundary length</span>
<span class='va'>b_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='boundary_matrix.html'>boundary_matrix</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span>

<span class='co'># standardize matrix values to lay between zero and one</span>
<span class='va'>b_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>b_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span>

<span class='co'># visualize connectivity matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='va'>b_matrix</span><span class='op'>)</span>
</div><div class='img'><img src='add_connectivity_penalties-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># create a symmetric connectivity matrix where the connectivity between</span>
<span class='co'># two planning units corresponds to their spatial proximity</span>
<span class='co'># i.e. planning units that are further apart share less connectivity</span>
<span class='va'>centroids</span> <span class='op'>&lt;-</span> <span class='fu'>rgeos</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rgeos/man/topo-unary-gCentroid.html'>gCentroid</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, byid <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>d_matrix</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>/</span> <span class='op'>(</span><span class='fu'><a href='as.Id.html'>as</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>)</span>, <span class='st'>"Matrix"</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># standardize matrix values to lay between zero and one</span>
<span class='va'>d_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>d_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span>

<span class='co'># remove connections between planning units without connectivity to</span>
<span class='co'># reduce run-time</span>
<span class='va'>d_matrix</span><span class='op'>[</span><span class='va'>d_matrix</span> <span class='op'>&lt;</span> <span class='fl'>0.7</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>

<span class='co'># visualize connectivity matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='va'>d_matrix</span><span class='op'>)</span>
</div><div class='img'><img src='add_connectivity_penalties-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># create a symmetric connectivity matrix where the connectivity</span>
<span class='co'># between adjacent two planning units corresponds to their combined</span>
<span class='co'># value in a field in the planning unit attribute data</span>
<span class='co'># for example, this field could describe the extent of native vegetation in</span>
<span class='co'># each planning unit and we could use connectivity penalties to identify</span>
<span class='co'># solutions that cluster planning units together that both contain large</span>
<span class='co'># amounts of native vegetation</span>
<span class='va'>c_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='connectivity_matrix.html'>connectivity_matrix</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, <span class='st'>"cost"</span><span class='op'>)</span>

<span class='co'># standardize matrix values to lay between zero and one</span>
<span class='va'>c_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>c_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span>

<span class='co'># visualize connectivity matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='va'>c_matrix</span><span class='op'>)</span>
</div><div class='img'><img src='add_connectivity_penalties-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># create an asymmetric connectivity matrix. Here, connectivity occurs between</span>
<span class='co'># adjacent planning units and, due to rivers flowing southwards</span>
<span class='co'># through the study area, connectivity from northern planning units to</span>
<span class='co'># southern planning units is ten times stronger than the reverse.</span>
<span class='va'>ac_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>ac_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.Id.html'>as</a></span><span class='op'>(</span><span class='va'>ac_matrix</span>, <span class='st'>"Matrix"</span><span class='op'>)</span>
<span class='va'>adjacent_units</span> <span class='op'>&lt;-</span> <span class='fu'>rgeos</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rgeos/man/pred-binary-gIntersects.html'>gIntersects</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span>, byid <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>j</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>sim_pu_polygons</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='co'># find if planning units are adjacent</span>
    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>adjacent_units</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='co'># find if planning units lay north and south of each other</span>
      <span class='co'># i.e. they have the same x-coordinate</span>
      <span class='kw'>if</span> <span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>i</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>==</span> <span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>j</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span>
        <span class='kw'>if</span> <span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>i</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>j</span>, <span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span>
          <span class='co'># if i is north of j add 10 units of connectivity</span>
          <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>+</span> <span class='fl'>10</span>
        <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>i</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='va'>centroids</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>[</span><span class='va'>j</span>, <span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>{</span>
          <span class='co'># if i is south of j add 1 unit of connectivity</span>
          <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>ac_matrix</span><span class='op'>[</span><span class='va'>i</span>, <span class='va'>j</span><span class='op'>]</span> <span class='op'>+</span> <span class='fl'>1</span>
        <span class='op'>}</span>
      <span class='op'>}</span>
    <span class='op'>}</span>
  <span class='op'>}</span>
<span class='op'>}</span>

<span class='co'># standardize matrix values to lay between zero and one</span>
<span class='va'>ac_matrix</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>rescale</span><span class='op'>(</span><span class='va'>ac_matrix</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span>

<span class='co'># visualize asymmetric connectivity matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='va'>ac_matrix</span><span class='op'>)</span>
</div><div class='img'><img src='add_connectivity_penalties-4.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># create penalties</span>
<span class='va'>penalties</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>25</span><span class='op'>)</span>

<span class='co'># create problems using the different connectivity matrices and penalties</span>
<span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p1</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>b_matrix</span><span class='op'>)</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>b_matrix</span><span class='op'>)</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>d_matrix</span><span class='op'>)</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>d_matrix</span><span class='op'>)</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>c_matrix</span><span class='op'>)</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>c_matrix</span><span class='op'>)</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>ac_matrix</span><span class='op'>)</span>,
           <span class='va'>p1</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, data <span class='op'>=</span> <span class='va'>ac_matrix</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># assign names to the problems</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>p2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basic problem"</span>,
               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"b_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span>,
               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"d_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span>,
               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"c_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span>,
               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"ac_matrix ("</span>, <span class='va'>penalties</span>,<span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># \dontrun{</span>
<span class='co'># solve problems</span>
<span class='va'>s2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>p2</span>, <span class='va'>solve</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 5 rows, 90 columns and 450 nonzeros
#&gt; Model fingerprint: 0x8a299781
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 9e-01]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 3934.6218396
#&gt; Presolve time: 0.00s
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; Variable types: 0 continuous, 90 integer (90 binary)
#&gt; Presolved: 5 rows, 90 columns, 450 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 3.496032e+03, 16 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 3496.03193    0    4 3934.62184 3496.03193  11.1%     -    0s
#&gt; H    0     0                    3585.9601335 3496.03193  2.51%     -    0s
#&gt; 
#&gt; Explored 1 nodes (16 simplex iterations) in 0.00 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 3585.96 3934.62 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 3.585960133519e+03, best bound 3.496031931890e+03, gap 2.5078%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 581 rows, 378 columns and 1602 nonzeros
#&gt; Model fingerprint: 0x45c875ef
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [3e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 17287.196992
#&gt; Found heuristic solution: objective 3691.2885062
#&gt; Presolve time: 0.00s
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 3.307193e+03, 144 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 3307.19310    0   86 3691.28851 3307.19310  10.4%     -    0s
#&gt; H    0     0                    3420.5820794 3307.19310  3.31%     -    0s
#&gt; 
#&gt; Explored 1 nodes (144 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 3420.58 3691.29 17287.2 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 3.420582079377e+03, best bound 3.307193102718e+03, gap 3.3149%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 581 rows, 378 columns and 1602 nonzeros
#&gt; Model fingerprint: 0xcdcb78d8
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [8e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 15487.196992
#&gt; Found heuristic solution: objective 3326.2885062
#&gt; Presolve time: 0.00s
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 3.012030e+03, 185 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 3012.03046    0  138 3326.28851 3012.03046  9.45%     -    0s
#&gt; 
#&gt; Explored 0 nodes (185 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 3326.29 15487.2 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 3.326288506226e+03, best bound 3.012030457072e+03, gap 9.4477%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 1601 rows, 888 columns and 3642 nonzeros
#&gt; Model fingerprint: 0xc91594f0
#&gt; Variable types: 0 continuous, 888 integer (888 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [7e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 11397.038660
#&gt; Found heuristic solution: objective 2915.9453686
#&gt; Presolve time: 0.01s
#&gt; Presolved: 1601 rows, 888 columns, 3642 nonzeros
#&gt; Variable types: 0 continuous, 888 integer (888 binary)
#&gt; Presolved: 1601 rows, 888 columns, 3642 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 2.277325e+03, 577 iterations, 0.02 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 2277.32517    0  877 2915.94537 2277.32517  21.9%     -    0s
#&gt;      0     0 2282.91603    0  874 2915.94537 2282.91603  21.7%     -    0s
#&gt;      0     0 2288.17279    0  870 2915.94537 2288.17279  21.5%     -    0s
#&gt;      0     0 2288.17279    0  483 2915.94537 2288.17279  21.5%     -    0s
#&gt;      0     0 2301.85077    0  453 2915.94537 2301.85077  21.1%     -    0s
#&gt;      0     0 2312.51908    0  474 2915.94537 2312.51908  20.7%     -    0s
#&gt;      0     0 2319.84387    0  472 2915.94537 2319.84387  20.4%     -    0s
#&gt;      0     0 2319.84387    0  472 2915.94537 2319.84387  20.4%     -    0s
#&gt; H    0     0                    2864.8646121 2319.84387  19.0%     -    0s
#&gt; H    0     0                    2839.2577729 2319.84387  18.3%     -    0s
#&gt; H    0     0                    2795.9652604 2319.84387  17.0%     -    0s
#&gt; H    0     0                    2695.1237322 2319.84387  13.9%     -    0s
#&gt;      0     2 2319.86297    0  472 2695.12373 2319.86297  13.9%     -    0s
#&gt; H   27    27                    2681.8550562 2357.67123  12.1%  78.7    0s
#&gt; H   43    43                    2618.4357550 2357.67123  10.0%  60.8    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 5
#&gt; 
#&gt; Explored 44 nodes (3973 simplex iterations) in 0.70 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 8: 2618.44 2681.86 2695.12 ... 11397
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 2.618435755005e+03, best bound 2.357671231155e+03, gap 9.9588%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 1601 rows, 888 columns and 3642 nonzeros
#&gt; Model fingerprint: 0xd9131e7d
#&gt; Variable types: 0 continuous, 888 integer (888 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+01, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 761.8011610
#&gt; Presolve time: 0.01s
#&gt; Presolved: 1601 rows, 888 columns, 3642 nonzeros
#&gt; Variable types: 0 continuous, 888 integer (888 binary)
#&gt; Presolved: 1601 rows, 888 columns, 3642 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 1.267850e+02, 250 iterations, 0.01 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0  126.78496    0  695  761.80116  126.78496  83.4%     -    0s
#&gt;      0     0  139.94535    0  693  761.80116  139.94535  81.6%     -    0s
#&gt;      0     0  151.81747    0  691  761.80116  151.81747  80.1%     -    0s
#&gt;      0     0  151.81747    0  382  761.80116  151.81747  80.1%     -    0s
#&gt;      0     0  183.26509    0  379  761.80116  183.26509  75.9%     -    0s
#&gt;      0     0  195.65454    0  361  761.80116  195.65454  74.3%     -    0s
#&gt;      0     0  195.65454    0  361  761.80116  195.65454  74.3%     -    0s
#&gt;      0     2  196.04007    0  361  761.80116  196.04007  74.3%     -    0s
#&gt; H    1     1                     527.6846537  196.04007  62.8%   0.0    0s
#&gt; H    2     2                     421.3259805  198.90231  52.8%  37.0    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 4
#&gt; 
#&gt; Explored 37 nodes (2240 simplex iterations) in 0.86 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 421.326 527.685 761.801 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 4.213259804528e+02, best bound 3.869756822705e+02, gap 8.1529%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 581 rows, 378 columns and 1602 nonzeros
#&gt; Model fingerprint: 0xcef450e1
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [9e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 15721.108025
#&gt; Found heuristic solution: objective 3513.2283384
#&gt; Presolve time: 0.01s
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 3.099126e+03, 229 iterations, 0.01 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 3099.12568    0  190 3513.22834 3099.12568  11.8%     -    0s
#&gt;      0     0 3106.66724    0  168 3513.22834 3106.66724  11.6%     -    0s
#&gt; H    0     0                    3244.5496513 3106.66724  4.25%     -    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 1
#&gt; 
#&gt; Explored 1 nodes (280 simplex iterations) in 0.08 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 3244.55 3513.23 15721.1 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 3.244549651264e+03, best bound 3.106667235508e+03, gap 4.2497%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 581 rows, 378 columns and 1602 nonzeros
#&gt; Model fingerprint: 0xe631c08b
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+01, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 11571.974576
#&gt; Found heuristic solution: objective 2881.1380866
#&gt; Presolve time: 0.01s
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; Variable types: 0 continuous, 378 integer (378 binary)
#&gt; Presolved: 581 rows, 378 columns, 1602 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 2.309063e+03, 214 iterations, 0.02 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 2309.06312    0  362 2881.13809 2309.06312  19.9%     -    0s
#&gt;      0     0 2328.08763    0  359 2881.13809 2328.08763  19.2%     -    0s
#&gt;      0     0 2342.30569    0  364 2881.13809 2342.30569  18.7%     -    0s
#&gt;      0     0 2342.30569    0  224 2881.13809 2342.30569  18.7%     -    0s
#&gt;      0     0 2346.69068    0  226 2881.13809 2346.69068  18.5%     -    0s
#&gt;      0     0 2347.37135    0  226 2881.13809 2347.37135  18.5%     -    0s
#&gt;      0     0 2363.28032    0  226 2881.13809 2363.28032  18.0%     -    0s
#&gt;      0     0 2373.42945    0  170 2881.13809 2373.42945  17.6%     -    0s
#&gt;      0     0 2373.42945    0  170 2881.13809 2373.42945  17.6%     -    0s
#&gt; H    0     0                    2601.7760176 2373.42945  8.78%     -    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 4
#&gt; 
#&gt; Explored 1 nodes (733 simplex iterations) in 0.50 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 2601.78 2881.14 11572 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 2.601776017639e+03, best bound 2.373429453835e+03, gap 8.7766%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 293 rows, 234 columns and 1026 nonzeros
#&gt; Model fingerprint: 0x4201042c
#&gt; Variable types: 0 continuous, 234 integer (234 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [1e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 17098.178722
#&gt; Found heuristic solution: objective 3824.6218396
#&gt; Presolve time: 0.01s
#&gt; Presolved: 293 rows, 234 columns, 1026 nonzeros
#&gt; Variable types: 0 continuous, 234 integer (234 binary)
#&gt; Presolved: 293 rows, 234 columns, 1026 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 3.385781e+03, 46 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 3385.78126    0   24 3824.62184 3385.78126  11.5%     -    0s
#&gt; H    0     0                    3518.9930072 3385.78126  3.79%     -    0s
#&gt; 
#&gt; Explored 1 nodes (46 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 3518.99 3824.62 17098.2 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 3.518993007168e+03, best bound 3.385781260518e+03, gap 3.7855%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 293 rows, 234 columns and 1026 nonzeros
#&gt; Model fingerprint: 0xa9af5ce8
#&gt; Variable types: 0 continuous, 234 integer (234 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [6e+00, 1e+01]
#&gt; Found heuristic solution: objective 15910.178722
#&gt; Found heuristic solution: objective 3659.6218396
#&gt; Presolve time: 0.00s
#&gt; Presolved: 293 rows, 234 columns, 1026 nonzeros
#&gt; Variable types: 0 continuous, 234 integer (234 binary)
#&gt; Presolved: 293 rows, 234 columns, 1026 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 3.172486e+03, 93 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 3172.48586    0   64 3659.62184 3172.48586  13.3%     -    0s
#&gt; H    0     0                    3383.4675383 3172.48586  6.24%     -    0s
#&gt; 
#&gt; Explored 1 nodes (93 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 3383.47 3659.62 15910.2 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 3.383467538304e+03, best bound 3.172485864952e+03, gap 6.2357%</div><div class='input'>
<span class='co'># plot solutions</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>s2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s2</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>p2</span><span class='op'>)</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>, cex <span class='op'>=</span> <span class='fl'>1.5</span>, col <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s2</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>[</span><span class='va'>s2</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>solution_1</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='op'>]</span>, col <span class='op'>=</span> <span class='st'>"darkgreen"</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='op'>}</span>
</div><div class='img'><img src='add_connectivity_penalties-5.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>

<span class='co'># create minimal multi-zone problem and limit solver to one minute</span>
<span class='co'># to obtain solutions in a short period of time</span>
<span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='problem.html'>problem</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span>, <span class='va'>sim_features_zones</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='add_min_set_objective.html'>add_min_set_objective</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='add_relative_targets.html'>add_relative_targets</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0.15</span>, nrow <span class='op'>=</span> <span class='fl'>5</span>, ncol <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='add_binary_decisions.html'>add_binary_decisions</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='add_default_solver.html'>add_default_solver</a></span><span class='op'>(</span>time_limit <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span>

<span class='co'># create matrix showing which planning units are adjacent to other units</span>
<span class='va'>a_matrix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='adjacency_matrix.html'>adjacency_matrix</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span><span class='op'>)</span>

<span class='co'># visualize matrix</span>
<span class='co'># \dontrun{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='va'>a_matrix</span><span class='op'>)</span>
</div><div class='img'><img src='add_connectivity_penalties-6.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># create a zone matrix where connectivities are only present between</span>
<span class='co'># planning units that are allocated to the same zone</span>
<span class='va'>zm1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.Id.html'>as</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span>, <span class='st'>"Matrix"</span><span class='op'>)</span>

<span class='co'># print zone matrix</span>
<span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm1</span><span class='op'>)</span>
</div><div class='output co'>#&gt;      [,1] [,2] [,3]
#&gt; [1,]    1    .    .
#&gt; [2,]    .    1    .
#&gt; [3,]    .    .    1</div><div class='input'>
<span class='co'># create a zone matrix where connectivities are strongest between</span>
<span class='co'># planning units allocated to different zones</span>
<span class='va'>zm2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>zm2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
<span class='va'>zm2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.Id.html'>as</a></span><span class='op'>(</span><span class='va'>zm2</span>, <span class='st'>"Matrix"</span><span class='op'>)</span>

<span class='co'># print zone matrix</span>
<span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 3 x 3 Matrix of class "dsyMatrix"
#&gt;      [,1] [,2] [,3]
#&gt; [1,]    0    1    1
#&gt; [2,]    1    0    1
#&gt; [3,]    1    1    0</div><div class='input'>
<span class='co'># create a zone matrix that indicates that connectivities between planning</span>
<span class='co'># units assigned to the same zone are much higher than connectivities</span>
<span class='co'># assigned to different zones</span>
<span class='va'>zm3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0.1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>zm3</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>zm3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.Id.html'>as</a></span><span class='op'>(</span><span class='va'>zm3</span>, <span class='st'>"Matrix"</span><span class='op'>)</span>

<span class='co'># print zone matrix</span>
<span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm3</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 3 x 3 Matrix of class "dsyMatrix"
#&gt;      [,1] [,2] [,3]
#&gt; [1,]  1.0  0.1  0.1
#&gt; [2,]  0.1  1.0  0.1
#&gt; [3,]  0.1  0.1  1.0</div><div class='input'>
<span class='co'># create a zone matrix that indicates that connectivities between planning</span>
<span class='co'># units allocated to zone 1 are very high, connectivities between planning</span>
<span class='co'># units allocated to zones 1 and 2 are moderately high, and connectivities</span>
<span class='co'># planning units allocated to other zones are low</span>
<span class='va'>zm4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0.1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>zm4</span><span class='op'>[</span><span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>zm4</span><span class='op'>[</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span>
<span class='va'>zm4</span><span class='op'>[</span><span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span>
<span class='va'>zm4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.Id.html'>as</a></span><span class='op'>(</span><span class='va'>zm4</span>, <span class='st'>"Matrix"</span><span class='op'>)</span>

<span class='co'># print zone matrix</span>
<span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm4</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 3 x 3 Matrix of class "dsyMatrix"
#&gt;      [,1] [,2] [,3]
#&gt; [1,]  1.0  0.5  0.1
#&gt; [2,]  0.5  0.1  0.1
#&gt; [3,]  0.1  0.1  0.1</div><div class='input'>
<span class='co'># create a zone matrix with strong connectivities between planning units</span>
<span class='co'># allocated to the same zone, moderate connectivities between planning</span>
<span class='co'># unit allocated to zone 1 and zone 2, and negative connectivities between</span>
<span class='co'># planning units allocated to zone 3 and the other two zones</span>
<span class='va'>zm5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, ncol <span class='op'>=</span> <span class='fl'>3</span>, nrow <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>zm5</span><span class='op'>[</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span>
<span class='va'>zm5</span><span class='op'>[</span><span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span>
<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span><span class='op'>(</span><span class='va'>zm5</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>zm5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='as.Id.html'>as</a></span><span class='op'>(</span><span class='va'>zm5</span>, <span class='st'>"Matrix"</span><span class='op'>)</span>

<span class='co'># print zone matrix</span>
<span class='fu'><a href='print.html'>print</a></span><span class='op'>(</span><span class='va'>zm5</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 3 x 3 Matrix of class "dsyMatrix"
#&gt;      [,1] [,2] [,3]
#&gt; [1,]  1.0  0.5   -1
#&gt; [2,]  0.5  1.0   -1
#&gt; [3,] -1.0 -1.0    1</div><div class='input'>
<span class='co'># create vector of penalties to use creating problems</span>
<span class='va'>penalties2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fl'>15</span><span class='op'>)</span>

<span class='co'># create multi-zone problems using the adjacent connectivity matrix and</span>
<span class='co'># different zone matrices</span>
<span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  <span class='va'>p3</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm1</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm1</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm2</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm2</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm3</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm3</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm4</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm4</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>, <span class='va'>zm5</span>, <span class='va'>a_matrix</span><span class='op'>)</span>,
  <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='va'>penalties2</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>, <span class='va'>zm5</span>, <span class='va'>a_matrix</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># assign names to the problems</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>p4</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basic problem"</span>,
               <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"zm"</span>, <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>)</span>, each <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>, <span class='st'>" ("</span>,
                      <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='va'>penalties2</span>, <span class='fl'>2</span><span class='op'>)</span>, <span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># \dontrun{</span>
<span class='co'># solve problems</span>
<span class='va'>s4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>p4</span>, <span class='va'>solve</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 105 rows, 270 columns and 1620 nonzeros
#&gt; Model fingerprint: 0x7d5079e2
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 10275.924144
#&gt; Presolve time: 0.00s
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 8.943504e+03, 123 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 8943.50352    0   15 10275.9241 8943.50352  13.0%     -    0s
#&gt; H    0     0                    9111.3117236 8943.50352  1.84%     -    0s
#&gt; 
#&gt; Explored 1 nodes (123 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 9111.31 10275.9 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 9.111311723633e+03, best bound 8.943503517801e+03, gap 1.8418%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 1845 rows, 1140 columns and 5100 nonzeros
#&gt; Model fingerprint: 0x8fa4bd7d
#&gt; Variable types: 0 continuous, 1140 integer (1140 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [5e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 10075.924144
#&gt; Presolve time: 0.02s
#&gt; Presolved: 1845 rows, 1140 columns, 5100 nonzeros
#&gt; Variable types: 0 continuous, 1140 integer (1140 binary)
#&gt; Presolved: 1845 rows, 1140 columns, 5100 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 8.367447e+03, 765 iterations, 0.04 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 8367.44688    0  465 10075.9241 8367.44688  17.0%     -    0s
#&gt; H    0     0                    9099.7523523 8367.44688  8.05%     -    0s
#&gt; 
#&gt; Explored 1 nodes (765 simplex iterations) in 0.07 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 9099.75 10075.9 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 9.099752352318e+03, best bound 8.367446876836e+03, gap 8.0475%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 1845 rows, 1140 columns and 5100 nonzeros
#&gt; Model fingerprint: 0xca629722
#&gt; Variable types: 0 continuous, 1140 integer (1140 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+01, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 9675.9241439
#&gt; Presolve time: 0.02s
#&gt; Presolved: 1845 rows, 1140 columns, 5100 nonzeros
#&gt; Variable types: 0 continuous, 1140 integer (1140 binary)
#&gt; Presolved: 1845 rows, 1140 columns, 5100 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 6.996298e+03, 697 iterations, 0.03 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 6996.29839    0  729 9675.92414 6996.29839  27.7%     -    0s
#&gt; H    0     0                    9080.3591011 6996.29839  23.0%     -    0s
#&gt; H    0     0                    8415.1839955 6996.29839  16.9%     -    0s
#&gt;      0     0 7011.23418    0  716 8415.18400 7011.23418  16.7%     -    0s
#&gt;      0     0 7013.23473    0  737 8415.18400 7013.23473  16.7%     -    0s
#&gt;      0     0 7015.55563    0  715 8415.18400 7015.55563  16.6%     -    0s
#&gt;      0     0 7015.66210    0  716 8415.18400 7015.66210  16.6%     -    0s
#&gt;      0     0 7026.69054    0  746 8415.18400 7026.69054  16.5%     -    0s
#&gt;      0     0 7026.69054    0  452 8415.18400 7026.69054  16.5%     -    0s
#&gt; H    0     0                    8309.0446303 7026.69054  15.4%     -    0s
#&gt;      0     0 7030.91984    0  471 8309.04463 7030.91984  15.4%     -    0s
#&gt;      0     0 7040.37799    0  460 8309.04463 7040.37799  15.3%     -    0s
#&gt;      0     0 7042.98410    0  491 8309.04463 7042.98410  15.2%     -    0s
#&gt;      0     0 7045.09814    0  477 8309.04463 7045.09814  15.2%     -    0s
#&gt;      0     0 7045.42534    0  477 8309.04463 7045.42534  15.2%     -    0s
#&gt;      0     0 7048.61890    0  471 8309.04463 7048.61890  15.2%     -    0s
#&gt;      0     0 7051.18223    0  424 8309.04463 7051.18223  15.1%     -    0s
#&gt;      0     0 7051.88500    0  433 8309.04463 7051.88500  15.1%     -    0s
#&gt;      0     0 7051.88500    0  433 8309.04463 7051.88500  15.1%     -    0s
#&gt; H    0     0                    7745.6687148 7051.88500  8.96%     -    0s
#&gt; H    0     0                    7610.7536423 7051.88500  7.34%     -    0s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 12
#&gt; 
#&gt; Explored 1 nodes (2044 simplex iterations) in 0.62 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 6: 7610.75 7745.67 8309.04 ... 9675.92
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 7.610753642291e+03, best bound 7.051884997491e+03, gap 7.3431%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 3585 rows, 2010 columns and 8580 nonzeros
#&gt; Model fingerprint: 0xf19089ae
#&gt; Variable types: 0 continuous, 2010 integer (2010 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [5e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 9985.9241439
#&gt; Presolve time: 0.06s
#&gt; Presolved: 3585 rows, 2010 columns, 12060 nonzeros
#&gt; Variable types: 0 continuous, 2010 integer (2010 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 2715 rows, 2010 columns, 9450 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 8.346175e+03, 2865 iterations, 0.14 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 8346.17500    0  331 9985.92414 8346.17500  16.4%     -    0s
#&gt; H    0     0                    8799.3081865 8346.17500  5.15%     -    0s
#&gt; 
#&gt; Explored 1 nodes (3229 simplex iterations) in 0.23 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 8799.31 9985.92 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 8.799308186471e+03, best bound 8.346175000834e+03, gap 5.1496%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 3585 rows, 2010 columns and 8580 nonzeros
#&gt; Model fingerprint: 0x872bce14
#&gt; Variable types: 0 continuous, 2010 integer (2010 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+01, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 9405.9241439
#&gt; Presolve time: 0.06s
#&gt; Presolved: 3585 rows, 2010 columns, 12060 nonzeros
#&gt; Variable types: 0 continuous, 2010 integer (2010 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 2715 rows, 2010 columns, 9450 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 6.957796e+03, 3056 iterations, 0.20 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 6957.79614    0  362 9405.92414 6957.79614  26.0%     -    0s
#&gt; H    0     0                    7926.9421869 6957.79614  12.2%     -    0s
#&gt; H    0     0                    7597.6212856 6957.79614  8.42%     -    0s
#&gt; 
#&gt; Explored 1 nodes (3529 simplex iterations) in 0.53 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 7597.62 7926.94 9405.92 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 7.597621285606e+03, best bound 6.957796139168e+03, gap 8.4214%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 5325 rows, 2880 columns and 12060 nonzeros
#&gt; Model fingerprint: 0x6060acb1
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [5e-01, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 10046.924144
#&gt; Presolve time: 0.12s
#&gt; Presolved: 5325 rows, 2880 columns, 17280 nonzeros
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 4455 rows, 2880 columns, 14670 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 8.343967e+03, 2425 iterations, 0.18 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 8343.96746    0  837 10046.9241 8343.96746  17.0%     -    0s
#&gt; H    0     0                    9418.6923447 8343.96746  11.4%     -    0s
#&gt; H    0     0                    9304.8425328 8343.96746  10.3%     -    0s
#&gt; H    0     0                    8866.8800183 8343.96746  5.90%     -    0s
#&gt; 
#&gt; Explored 1 nodes (2638 simplex iterations) in 0.73 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 4: 8866.88 9304.84 9418.69 10046.9 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 8.866880018262e+03, best bound 8.343967460484e+03, gap 5.8974%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 5325 rows, 2880 columns and 12060 nonzeros
#&gt; Model fingerprint: 0x2f887726
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 9588.9241439
#&gt; Presolve time: 0.12s
#&gt; Presolved: 5325 rows, 2880 columns, 17280 nonzeros
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 4455 rows, 2880 columns, 14670 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 6.879922e+03, 2902 iterations, 0.25 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 6879.92223    0 1025 9588.92414 6879.92223  28.3%     -    0s
#&gt; H    0     0                    9250.2255825 6879.92223  25.6%     -    0s
#&gt; H    0     0                    8667.5210228 6879.92223  20.6%     -    0s
#&gt; H    0     0                    8242.3766500 6879.92223  16.5%     -    0s
#&gt;      0     0 6892.73663    0 1019 8242.37665 6892.73663  16.4%     -    0s
#&gt;      0     0 6892.89635    0 1031 8242.37665 6892.89635  16.4%     -    0s
#&gt;      0     0 6892.91502    0 1018 8242.37665 6892.91502  16.4%     -    0s
#&gt;      0     0 6899.10865    0 1105 8242.37665 6899.10865  16.3%     -    0s
#&gt;      0     0 6900.39546    0 1022 8242.37665 6900.39546  16.3%     -    0s
#&gt;      0     0 6901.08940    0 1102 8242.37665 6901.08940  16.3%     -    0s
#&gt;      0     0 6904.12553    0 1120 8242.37665 6904.12553  16.2%     -    1s
#&gt;      0     0 6904.12553    0 1120 8242.37665 6904.12553  16.2%     -    1s
#&gt;      0     0 6907.12877    0 1099 8242.37665 6907.12877  16.2%     -    1s
#&gt;      0     0 6907.12877    0 1099 8242.37665 6907.12877  16.2%     -    1s
#&gt;      0     0 6910.20380    0 1010 8242.37665 6910.20380  16.2%     -    1s
#&gt;      0     0 6912.14934    0 1040 8242.37665 6912.14934  16.1%     -    1s
#&gt;      0     0 6913.67833    0 1020 8242.37665 6913.67833  16.1%     -    1s
#&gt;      0     0 6916.18109    0 1002 8242.37665 6916.18109  16.1%     -    1s
#&gt;      0     0 6918.95268    0 1002 8242.37665 6918.95268  16.1%     -    1s
#&gt;      0     0 6920.85166    0  990 8242.37665 6920.85166  16.0%     -    2s
#&gt;      0     0 6923.79315    0  984 8242.37665 6923.79315  16.0%     -    2s
#&gt;      0     0 6925.74734    0 1007 8242.37665 6925.74734  16.0%     -    2s
#&gt;      0     0 6928.64118    0 1007 8242.37665 6928.64118  15.9%     -    2s
#&gt;      0     0 6930.58951    0 1003 8242.37665 6930.58951  15.9%     -    2s
#&gt;      0     0 6933.57942    0 1024 8242.37665 6933.57942  15.9%     -    2s
#&gt;      0     0 6933.58249    0 1023 8242.37665 6933.58249  15.9%     -    2s
#&gt;      0     0 6934.11565    0 1025 8242.37665 6934.11565  15.9%     -    2s
#&gt;      0     0 6934.12216    0 1018 8242.37665 6934.12216  15.9%     -    2s
#&gt;      0     0 6936.13079    0 1000 8242.37665 6936.13079  15.8%     -    2s
#&gt;      0     0 6936.43871    0 1005 8242.37665 6936.43871  15.8%     -    3s
#&gt; H    0     0                    8035.3567102 6936.43871  13.7%     -    3s
#&gt;      0     0 6937.71962    0 1000 8035.35671 6937.71962  13.7%     -    3s
#&gt;      0     0 6937.72807    0 1010 8035.35671 6937.72807  13.7%     -    3s
#&gt;      0     0 6938.31210    0 1032 8035.35671 6938.31210  13.7%     -    3s
#&gt;      0     0 6939.05267    0 1014 8035.35671 6939.05267  13.6%     -    3s
#&gt;      0     0 6940.17552    0 1038 8035.35671 6940.17552  13.6%     -    3s
#&gt;      0     0 6941.05045    0 1036 8035.35671 6941.05045  13.6%     -    3s
#&gt;      0     0 6941.09407    0 1032 8035.35671 6941.09407  13.6%     -    3s
#&gt;      0     0 6941.61556    0 1031 8035.35671 6941.61556  13.6%     -    3s
#&gt;      0     0 6942.56715    0 1029 8035.35671 6942.56715  13.6%     -    3s
#&gt;      0     0 6942.96685    0 1028 8035.35671 6942.96685  13.6%     -    4s
#&gt;      0     0 6943.22789    0 1030 8035.35671 6943.22789  13.6%     -    4s
#&gt;      0     0 6943.22789    0 1030 8035.35671 6943.22789  13.6%     -    4s
#&gt; H    0     0                    7642.8860399 6943.22789  9.15%     -    4s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 6
#&gt;   Zero half: 346
#&gt; 
#&gt; Explored 1 nodes (5178 simplex iterations) in 4.79 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 6: 7642.89 8035.36 8242.38 ... 9588.92
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 7.642886039886e+03, best bound 6.943227894992e+03, gap 9.1544%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 5325 rows, 2880 columns and 12060 nonzeros
#&gt; Model fingerprint: 0xb9d99cac
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [5e-01, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 10118.924144
#&gt; Presolve time: 0.14s
#&gt; Presolved: 5325 rows, 2880 columns, 17280 nonzeros
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 4455 rows, 2880 columns, 14670 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 8.569664e+03, 2987 iterations, 0.24 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 8569.66432    0  836 10118.9241 8569.66432  15.3%     -    0s
#&gt; H    0     0                    9683.1874275 8569.66432  11.5%     -    0s
#&gt; H    0     0                    9394.6143411 8569.66432  8.78%     -    0s
#&gt; 
#&gt; Explored 1 nodes (3441 simplex iterations) in 0.48 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 9394.61 9683.19 10118.9 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 9.394614341144e+03, best bound 8.569664324288e+03, gap 8.7811%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 5325 rows, 2880 columns and 12060 nonzeros
#&gt; Model fingerprint: 0xe5c0bdf1
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 9804.9241439
#&gt; Presolve time: 0.17s
#&gt; Presolved: 5325 rows, 2880 columns, 17280 nonzeros
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 4455 rows, 2880 columns, 14670 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 7.568330e+03, 3223 iterations, 0.33 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 7568.33011    0 1004 9804.92414 7568.33011  22.8%     -    0s
#&gt; H    0     0                    9208.2212376 7568.33011  17.8%     -    0s
#&gt; H    0     0                    9077.0927119 7568.33011  16.6%     -    0s
#&gt; H    0     0                    8474.9575361 7568.33011  10.7%     -    0s
#&gt;      0     0 7594.13649    0 1176 8474.95754 7594.13649  10.4%     -    1s
#&gt;      0     0 7608.69213    0 1263 8474.95754 7608.69213  10.2%     -    1s
#&gt;      0     0 7608.69213    0 1265 8474.95754 7608.69213  10.2%     -    1s
#&gt;      0     0 7645.39688    0 1088 8474.95754 7645.39688  9.79%     -    1s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 3
#&gt;   Zero half: 140
#&gt; 
#&gt; Explored 1 nodes (5578 simplex iterations) in 1.90 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 4: 8474.96 9077.09 9208.22 9804.92 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 8.474957536084e+03, best bound 7.645396875043e+03, gap 9.7884%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 6485 rows, 2880 columns and 15540 nonzeros
#&gt; Model fingerprint: 0xffd78fe6
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 10084.071885
#&gt; Presolve time: 0.16s
#&gt; Presolved: 6485 rows, 2880 columns, 21920 nonzeros
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 5615 rows, 2880 columns, 19310 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 8.178938e+03, 1497 iterations, 0.21 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 8178.93759    0  960 10084.0719 8178.93759  18.9%     -    0s
#&gt; H    0     0                    9530.2541080 8178.93759  14.2%     -    0s
#&gt; H    0     0                    8922.0168782 8178.93759  8.33%     -    0s
#&gt; 
#&gt; Explored 1 nodes (1497 simplex iterations) in 0.86 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 3: 8922.02 9530.25 10084.1 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 8.922016878228e+03, best bound 8.178937587478e+03, gap 8.3286%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 6485 rows, 2880 columns and 15540 nonzeros
#&gt; Model fingerprint: 0xc809035a
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [8e+00, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 9594.0718845
#&gt; Presolve time: 0.16s
#&gt; Presolved: 6485 rows, 2880 columns, 21920 nonzeros
#&gt; Variable types: 0 continuous, 2880 integer (2880 binary)
#&gt; Presolve removed 870 rows and 0 columns
#&gt; Presolved: 5615 rows, 2880 columns, 19310 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 6.327933e+03, 1370 iterations, 0.18 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 6327.93284    0 1112 9594.07188 6327.93284  34.0%     -    0s
#&gt; H    0     0                    8751.9802992 6327.93284  27.7%     -    0s
#&gt; H    0     0                    8141.1224635 6327.93284  22.3%     -    0s
#&gt;      0     0 6358.68256    0 1202 8141.12246 6358.68256  21.9%     -    1s
#&gt;      0     0 6359.23942    0 1184 8141.12246 6359.23942  21.9%     -    1s
#&gt;      0     0 6378.84568    0 1197 8141.12246 6378.84568  21.6%     -    1s
#&gt;      0     0 6381.73982    0 1185 8141.12246 6381.73982  21.6%     -    1s
#&gt;      0     0 6395.98331    0 1178 8141.12246 6395.98331  21.4%     -    1s
#&gt;      0     0 6405.80422    0 1174 8141.12246 6405.80422  21.3%     -    2s
#&gt;      0     0 6405.82199    0 1168 8141.12246 6405.82199  21.3%     -    2s
#&gt;      0     0 6409.61810    0 1237 8141.12246 6409.61810  21.3%     -    2s
#&gt;      0     0 6409.78889    0 1237 8141.12246 6409.78889  21.3%     -    2s
#&gt;      0     0 6420.32566    0 1202 8141.12246 6420.32566  21.1%     -    2s
#&gt;      0     0 6421.45125    0 1204 8141.12246 6421.45125  21.1%     -    2s
#&gt;      0     0 6429.82320    0 1186 8141.12246 6429.82320  21.0%     -    2s
#&gt;      0     0 6429.94172    0 1186 8141.12246 6429.94172  21.0%     -    2s
#&gt;      0     0 6431.35597    0 1198 8141.12246 6431.35597  21.0%     -    2s
#&gt;      0     0 6440.57755    0 1196 8141.12246 6440.57755  20.9%     -    2s
#&gt;      0     0 6442.10471    0 1169 8141.12246 6442.10471  20.9%     -    3s
#&gt;      0     0 6450.78356    0 1176 8141.12246 6450.78356  20.8%     -    3s
#&gt;      0     0 6452.36696    0 1173 8141.12246 6452.36696  20.7%     -    3s
#&gt;      0     0 6460.14882    0 1183 8141.12246 6460.14882  20.6%     -    3s
#&gt;      0     0 6460.36368    0 1185 8141.12246 6460.36368  20.6%     -    3s
#&gt;      0     0 6467.73994    0 1288 8141.12246 6467.73994  20.6%     -    3s
#&gt;      0     0 6467.80993    0 1288 8141.12246 6467.80993  20.6%     -    3s
#&gt;      0     0 6468.05573    0 1287 8141.12246 6468.05573  20.6%     -    3s
#&gt;      0     0 6468.05573    0 1287 8141.12246 6468.05573  20.6%     -    4s
#&gt; H    0     0                    8013.0781637 6468.05573  19.3%     -    5s
#&gt;      0     0 6906.28153    0  837 8013.07816 6906.28153  13.8%     -    6s
#&gt; H    0     0                    7784.9336456 6906.28153  11.3%     -    6s
#&gt;      0     0 6945.36692    0  832 7784.93365 6945.36692  10.8%     -    7s
#&gt;      0     0 6953.28834    0  854 7784.93365 6953.28834  10.7%     -    7s
#&gt;      0     0 6957.56208    0  879 7784.93365 6957.56208  10.6%     -    7s
#&gt;      0     0 6958.86193    0  842 7784.93365 6958.86193  10.6%     -    7s
#&gt;      0     0 6959.32732    0  877 7784.93365 6959.32732  10.6%     -    7s
#&gt;      0     0 6959.32732    0  876 7784.93365 6959.32732  10.6%     -    7s
#&gt;      0     0 6960.09896    0  885 7784.93365 6960.09896  10.6%     -    7s
#&gt;      0     0 6960.09903    0  909 7784.93365 6960.09903  10.6%     -    7s
#&gt;      0     0 6961.39059    0  892 7784.93365 6961.39059  10.6%     -    7s
#&gt;      0     0 6961.70516    0  903 7784.93365 6961.70516  10.6%     -    7s
#&gt;      0     0 6961.71233    0  906 7784.93365 6961.71233  10.6%     -    7s
#&gt;      0     0 6966.24375    0  869 7784.93365 6966.24375  10.5%     -    8s
#&gt;      0     0 6967.77144    0  818 7784.93365 6967.77144  10.5%     -    8s
#&gt;      0     0 6967.77326    0  812 7784.93365 6967.77326  10.5%     -    8s
#&gt;      0     0 6967.95907    0  845 7784.93365 6967.95907  10.5%     -    8s
#&gt;      0     0 6969.11754    0  903 7784.93365 6969.11754  10.5%     -    8s
#&gt;      0     0 6969.58344    0  862 7784.93365 6969.58344  10.5%     -    8s
#&gt;      0     0 6969.58344    0  862 7784.93365 6969.58344  10.5%     -    8s
#&gt;      0     0 6969.69131    0  907 7784.93365 6969.69131  10.5%     -    8s
#&gt;      0     0 6969.71417    0  910 7784.93365 6969.71417  10.5%     -    8s
#&gt;      0     0 6970.01506    0  853 7784.93365 6970.01506  10.5%     -    8s
#&gt;      0     0 6970.01655    0  853 7784.93365 6970.01655  10.5%     -    8s
#&gt;      0     0 6970.98356    0  881 7784.93365 6970.98356  10.5%     -    8s
#&gt;      0     0 6971.15791    0  924 7784.93365 6971.15791  10.5%     -    8s
#&gt;      0     0 6971.15822    0  924 7784.93365 6971.15822  10.5%     -    8s
#&gt;      0     0 6971.15822    0  917 7784.93365 6971.15822  10.5%     -    9s
#&gt;      0     2 6971.28128    0  917 7784.93365 6971.28128  10.5%     -    9s
#&gt;      4     6 7040.18292    2  855 7784.93365 6994.97891  10.1%   601   10s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 6
#&gt;   Implied bound: 2
#&gt;   Zero half: 131
#&gt;   Mod-K: 5
#&gt; 
#&gt; Explored 7 nodes (11651 simplex iterations) in 10.32 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 5: 7784.93 8013.08 8141.12 ... 9594.07
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 7.784933645564e+03, best bound 7.015269364509e+03, gap 9.8866%</div><div class='input'><span class='va'>s4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>s4</span>, <span class='va'>category_layer</span><span class='op'>)</span>
<span class='va'>s4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/stack.html'>stack</a></span><span class='op'>(</span><span class='va'>s4</span><span class='op'>)</span>

<span class='co'># plot solutions</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s4</span>, main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>p4</span><span class='op'>)</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='add_connectivity_penalties-7.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>

<span class='co'># create an array to manually specify the connectivities between</span>
<span class='co'># each planning unit when they are allocated to each different zone</span>
<span class='co'># for real-world problems, these connectivities would be generated using</span>
<span class='co'># data - but here these connectivity values are assigned as random</span>
<span class='co'># ones or zeros</span>
<span class='va'>c_array</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='OptimizationProblem-methods.html'>ncell</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>, <span class='fl'>2</span><span class='op'>)</span>, <span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>z1</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>z2</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
    <span class='va'>c_array</span><span class='op'>[</span>, , <span class='va'>z1</span>, <span class='va'>z2</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fu'><a href='OptimizationProblem-methods.html'>ncell</a></span><span class='op'>(</span><span class='va'>sim_pu_zones_stack</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>^</span> <span class='fl'>2</span>,
                                       <span class='fl'>0</span>, <span class='fl'>0.505</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># create a problem with the manually specified connectivity array</span>
<span class='co'># note that the zones argument is set to NULL because the connectivity</span>
<span class='co'># data is an array</span>
<span class='va'>p5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p3</span>,
           <span class='va'>p3</span> <span class='op'>%&gt;%</span> <span class='fu'>add_connectivity_penalties</span><span class='op'>(</span><span class='fl'>15</span>, zones <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>c_array</span><span class='op'>)</span><span class='op'>)</span>


<span class='co'># assign names to the problems</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"basic problem"</span>, <span class='st'>"connectivity array"</span><span class='op'>)</span>
<span class='co'># \dontrun{</span>
<span class='co'># solve problems</span>
<span class='va'>s5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>p5</span>, <span class='va'>solve</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 105 rows, 270 columns and 1620 nonzeros
#&gt; Model fingerprint: 0x7d5079e2
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+02, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 10275.924144
#&gt; Presolve time: 0.00s
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; Variable types: 0 continuous, 270 integer (270 binary)
#&gt; Presolved: 105 rows, 270 columns, 1620 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 8.943504e+03, 123 iterations, 0.00 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 8943.50352    0   15 10275.9241 8943.50352  13.0%     -    0s
#&gt; H    0     0                    9111.3117236 8943.50352  1.84%     -    0s
#&gt; 
#&gt; Explored 1 nodes (123 simplex iterations) in 0.01 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 2: 9111.31 10275.9 
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 9.111311723633e+03, best bound 8.943503517801e+03, gap 1.8418%
#&gt; Gurobi Optimizer version 9.0.2 build v9.0.2rc0 (linux64)
#&gt; Optimize a model with 1479 rows, 957 columns and 4368 nonzeros
#&gt; Model fingerprint: 0xe55a0252
#&gt; Variable types: 0 continuous, 957 integer (957 binary)
#&gt; Coefficient statistics:
#&gt;   Matrix range     [2e-01, 1e+00]
#&gt;   Objective range  [2e+01, 2e+02]
#&gt;   Bounds range     [1e+00, 1e+00]
#&gt;   RHS range        [1e+00, 1e+01]
#&gt; Found heuristic solution: objective 9930.9241439
#&gt; Presolve time: 0.02s
#&gt; Presolved: 1479 rows, 957 columns, 4412 nonzeros
#&gt; Variable types: 0 continuous, 957 integer (957 binary)
#&gt; Presolve removed 22 rows and 0 columns
#&gt; Presolved: 1457 rows, 957 columns, 4346 nonzeros
#&gt; 
#&gt; 
#&gt; Root relaxation: objective 7.525786e+03, 1032 iterations, 0.05 seconds
#&gt; 
#&gt;     Nodes    |    Current Node    |     Objective Bounds      |     Work
#&gt;  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#&gt; 
#&gt;      0     0 7525.78580    0  738 9930.92414 7525.78580  24.2%     -    0s
#&gt; H    0     0                    9026.3087578 7525.78580  16.6%     -    0s
#&gt; H    0     0                    8900.5385498 7525.78580  15.4%     -    0s
#&gt;      0     0 7537.10979    0  735 8900.53855 7537.10979  15.3%     -    0s
#&gt;      0     0 7544.15924    0  697 8900.53855 7544.15924  15.2%     -    0s
#&gt;      0     0 7548.40860    0  710 8900.53855 7548.40860  15.2%     -    0s
#&gt;      0     0 7548.40860    0  710 8900.53855 7548.40860  15.2%     -    0s
#&gt; H    0     0                    8576.4437968 7548.40860  12.0%     -    1s
#&gt; H    0     0                    8325.3025504 7548.40860  9.33%     -    1s
#&gt; 
#&gt; Cutting planes:
#&gt;   Gomory: 3
#&gt; 
#&gt; Explored 1 nodes (1704 simplex iterations) in 1.02 seconds
#&gt; Thread count was 1 (of 4 available processors)
#&gt; 
#&gt; Solution count 5: 8325.3 8576.44 8900.54 ... 9930.92
#&gt; 
#&gt; Optimal solution found (tolerance 1.00e-01)
#&gt; Best objective 8.325302550405e+03, best bound 7.548408597562e+03, gap 9.3317%</div><div class='input'><span class='va'>s5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>s5</span>, <span class='va'>category_layer</span><span class='op'>)</span>
<span class='va'>s5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/stack.html'>stack</a></span><span class='op'>(</span><span class='va'>s5</span><span class='op'>)</span>

<span class='co'># plot solutions</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>s5</span>, main <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span>, axes <span class='op'>=</span> <span class='cn'>FALSE</span>, box <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='add_connectivity_penalties-8.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://jeffrey-hanson.com'>Jeffrey O Hanson</a>, <a href='http://www.richard-schuster.com'>Richard Schuster</a>, Nina Morrell, <a href='http://strimas.com'>Matthew Strimas-Mackey</a>, Matthew E Watts, <a href='https://arcese.forestry.ubc.ca'>Peter Arcese</a>, <a href='https://josephrbennett.wordpress.com'>Joseph Bennett</a>, <a href='http://www.possinghamlab.org'>Hugh P Possingham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: '486efa122ea6783724263412c5f28ab3',
    indexName: 'prioritizr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


